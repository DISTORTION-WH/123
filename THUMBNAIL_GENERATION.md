# Генерация превью для видео

## Описание

Приложение автоматически генерирует превью (thumbnail) для видеофайлов. Превью извлекается на отметке 1 секунда от начала видео.

**Важно:** Превью генерируются на фронтенде с помощью Canvas API. Это означает, что они работают в браузере пользователя и **не требуют FFmpeg на сервере**.

## Как это работает

### Frontend (На клиенте)

1. Видео загружается на страницу профиля
2. VideoThumbnail компонент создает скрытый HTML5 элемент `<video>`
3. Извлекает кадр на отметке 1 сек используя Canvas API
4. Конвертирует кадр в Data URL (JPEG изображение)
5. Отображает полученное изображение как превью
6. Результат кешируется, чтобы избежать повторной генерации

### Поддерживаемые форматы видео

- MP4 (video/mp4)
- WebM (video/webm)
- MOV (video/quicktime)
- AVI (video/x-msvideo)
- MKV (video/x-matroska)

## Отлично! А что насчет старого способа?

Если хотите использовать FFmpeg для предварительной генерации превью на сервере:

### Требования для FFmpeg (опционально)

- FFmpeg должен быть установлен и доступен в PATH

#### Установка FFmpeg

**Windows (через Chocolatey):**
```bash
choco install ffmpeg
```

**Windows (через scoop):**
```bash
scoop install ffmpeg
```

**macOS:**
```bash
brew install ffmpeg
```

**Linux (Ubuntu/Debian):**
```bash
sudo apt-get install ffmpeg
```

### Генерация превью для существующих видео (опционально)

Если у вас уже есть ffmpeg и вы хотите предварительно сгенерировать превью:

```bash
cd apps/core_microservice
npm run thumbnails:generate
```

Скрипт будет:
1. Найти все видеофайлы без `thumbnailPath` в БД
2. Сгенерировать превью для каждого видео
3. Сохранить путь к превью в БД

## Архитектура

### Files

- `video-thumbnail.ts` - Утилита для генерации превью (Canvas API)
- `VideoThumbnail.tsx` - React компонент для отображения
- `assets.service.ts` - Опциональная серверная генерация (ffmpeg)

### Место хранения файлов

- Видео: `/apps/core_microservice/uploads/{filename}.{ext}`
- Превью (если ffmpeg): `/apps/core_microservice/uploads/{filename}_thumb.jpg`
- Превью (клиентские): В памяти браузера (Data URL)

## Преимущества

✅ **Фронтенд генерация:**
- Не требует FFmpeg на сервере
- Работает для всех поддерживаемых браузерами видеоформатов
- Автоматический кеш в памяти
- Graceful fallback если не удалось сгенерировать

✅ **Серверная генерация (опционально):**
- Сохраняет превью в БД для будущих загрузок
- Снижает нагрузку на клиентские браузеры
- Предоставляет готовые превью для внешних приложений
